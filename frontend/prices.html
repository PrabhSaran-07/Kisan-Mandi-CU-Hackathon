<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prices - Kisan Mandi</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="navbar">
            <a href="/" class="logo"> Kisan Mandi</a>
            <ul class="nav-links">
                <li><a href="dashboard.html">Dashboard</a></li>
               
                <li><a href="chatbot.html">AI Chatbot</a></li>
                <li><a href="prices.html">Prices</a></li>
                <li id="userGreeting" style="color: #2ecc71;"></li>
                <li><button class="btn-logout" onclick="logout()">Logout</button></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="card">
            <div class="card-header"> Real-Time Crop Prices</div>
            <p>Current market prices from various sources (Demo Data + API Integration)</p>
        </div>

        <!-- Price Table -->
        <div class="card">
            <h3>Current Market Prices</h3>
            <div id="pricesContainer"></div>
        </div>

        <!-- Price Trends (Coming Soon) -->
        <div class="card">
            <div class="card-header"> Price Trends (Coming Soon)</div>
            <p>Historical price data visualization will help you make better trading decisions.</p>
            <div style="background: #f0f0f0; padding: 2rem; border-radius: 5px; text-align: center;">
                <p style="color: #95a5a6;">Graph will show price trends over time</p>
                <canvas id="priceChart" style="max-width: 100%; height: 300px;"></canvas>
            </div>
        </div>

        <!-- Price Prediction -->
        <div class="card">
            <div class="card-header"> AI Price Prediction</div>
            <p>Using historical data and seasonal trends, AI predicts future prices.</p>
            <div id="predictionsContainer"></div>
        </div>

        <!-- Data Sources -->
        <div class="card">
            <div class="card-header"> Data Sources</div>
            <ul style="list-style: none;">
                <li> <strong>AgriMarketNet API</strong> - Official agricultural prices from Indian government</li>
                <li> <strong>data.gov.in</strong> - Open government data on crop prices</li>
                <li> <strong>APMC Rates</strong> - Agricultural Produce Market Committee rates</li>
                <li> <strong>Location-Based Prices</strong> - Regional variations in crop prices</li>
            </ul>
        </div>
    </div>

    <footer>
        <p>&copy; 2026 Kisan Mandi. Real-time Agricultural Market Data</p>
    </footer>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        let currentUser = null;

        async function initPrices() {
            const userStr = localStorage.getItem('user');
            if (!userStr) {
                window.location.href = 'login.html';
                return;
            }

            currentUser = JSON.parse(userStr);
            document.getElementById('userGreeting').textContent = ` ${currentUser.username}`;
            
            await loadPrices();
            showPredictions();
        }

        async function loadPrices() {
            try {
                const response = await fetch(`${API_BASE}/prices`, {
                    credentials: 'include'
                });

                const prices = await response.json();

                let html = `
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #ecf0f1; border-bottom: 2px solid #bdc3c7;">
                                <th style="padding: 1rem; text-align: left;">Crop Name</th>
                                <th style="padding: 1rem; text-align: left;">Location</th>
                                <th style="padding: 1rem; text-align: right;">Price (₹/kg)</th>
                                <th style="padding: 1rem; text-align: left;">Date</th>
                                <th style="padding: 1rem; text-align: center;">Trend</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                prices.forEach(price => {
                    const date = new Date(price.date);
                    const formattedDate = date.toLocaleDateString();
                    html += `
                        <tr style="border-bottom: 1px solid #ecf0f1;">
                            <td style="padding: 1rem;"><strong>${price.crop_name}</strong></td>
                            <td style="padding: 1rem;"> ${price.location}</td>
                            <td style="padding: 1rem; text-align: right; color: #2ecc71; font-weight: bold;">₹${price.price.toFixed(2)}</td>
                            <td style="padding: 1rem;">${formattedDate}</td>
                            <td style="padding: 1rem; text-align: center;"></td>
                        </tr>
                    `;
                });

                html += `
                        </tbody>
                    </table>
                `;

                document.getElementById('pricesContainer').innerHTML = html;

            } catch (error) {
                document.getElementById('pricesContainer').innerHTML = `<p style="color: #e74c3c;">Error loading prices: ${error.message}</p>`;
            }
        }

        function showPredictions() {
            const predictions = [
                { crop: 'Wheat', current: 2200, predicted: 2350, change: '+6.8%', date: 'April 2026' },
                { crop: 'Rice', current: 3500, predicted: 3200, change: '-8.6%', date: 'April 2026' },
                { crop: 'Cotton', current: 5500, predicted: 5900, change: '+7.3%', date: 'April 2026' },
                { crop: 'Sugarcane', current: 1800, predicted: 1950, change: '+8.3%', date: 'April 2026' }
            ];

            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">';

            predictions.forEach(pred => {
                const isPositive = pred.change.startsWith('+');
                html += `
                    <div style="background: white; border-left: 4px solid ${isPositive ? '#2ecc71' : '#e74c3c'} ; padding: 1rem; border-radius: 5px;">
                        <h4>${pred.crop}</h4>
                        <p style="margin: 0.5rem 0; color: #95a5a6;">Current: ₹${pred.current}</p>
                        <p style="margin: 0.5rem 0; color: #95a5a6;">Predicted: ₹${pred.predicted}</p>
                        <p style="margin: 0.5rem 0; color: ${isPositive ? '#27ae60' : '#c0392b'}; font-weight: bold;">
                             ${pred.change}
                        </p>
                        <p style="margin: 0.5rem 0; font-size: 0.85rem; color: #95a5a6;">${pred.date}</p>
                    </div>
                `;
            });

            html += '</div>';
            document.getElementById('predictionsContainer').innerHTML = html;
        }

        function logout() {
            localStorage.removeItem('user');
            window.location.href = 'login.html';
        }

        // Initialize on load
        initPrices();
    </script>
</body>
</html>
